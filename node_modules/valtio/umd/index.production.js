!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("react"),require("proxy-compare"),require("use-sync-external-store/shim"),require("valtio/vanilla")):"function"==typeof define&&define.amd?define(["exports","react","proxy-compare","use-sync-external-store/shim","valtio/vanilla"],r):r((e="undefined"!=typeof globalThis?globalThis:e||self).valtio={},e.React,e.proxyCompare,e.shim,e.valtioVanilla)}(this,(function(e,r,n,t,o){"use strict";Object.defineProperty(e,"getVersion",{enumerable:!0,get:function(){return o.getVersion}}),Object.defineProperty(e,"proxy",{enumerable:!0,get:function(){return o.proxy}}),Object.defineProperty(e,"ref",{enumerable:!0,get:function(){return o.ref}}),Object.defineProperty(e,"snapshot",{enumerable:!0,get:function(){return o.snapshot}}),Object.defineProperty(e,"subscribe",{enumerable:!0,get:function(){return o.subscribe}}),Object.defineProperty(e,"unstable_getHandler",{enumerable:!0,get:function(){return o.getHandler}}),e.useSnapshot=function(e,u){var i=new WeakMap,a=r.useRef(),c=r.useRef(),s=null==u?void 0:u.sync,f=t.useSyncExternalStore(r.useCallback((function(r){c.current=r;var n=o.subscribe(e,r,s);return function(){n(),c.current=void 0}}),[e,s]),r.useMemo((function(){var r;return function(){var t=o.snapshot(e);try{if(r&&a.current&&!n.isChanged(r,t,a.current,new WeakMap))return r}catch(e){}return r=t}}),[e]),r.useCallback((function(){return o.snapshot(e)}),[e])),l=o.getVersion(e);r.useEffect((function(){a.current=i,l!==o.getVersion(e)&&(c.current?c.current():"object"==typeof process&&"production"!==process.env.NODE_ENV&&console.warn("[Bug] last callback is undefined"))}));var p=r.useMemo((function(){return new WeakMap}),[]);return n.createProxy(f,i,p)},Object.defineProperty(e,"__esModule",{value:!0})}));
